<template>
  <div class="sub-navigation">
    <nav v-if="activeItem" class="tabs" role="tablist">
      <router-link
        v-for="(tab, index) in itemTabs"
        :key="index"
        :to="tab.route"
        class="btn btn--sec tabs__tab"
        role="tab"
      >
        <span class="pkt-show-tablet-big-up">{{ tab.label }}</span>
        <span class="pkt-hide-tablet-big-up">{{ tab.shortLabel || tab.label }}</span>
      </router-link>

      <router-link
        v-if="hasEditRights"
        :to="{ name: 'ItemAdmin', query: adminLinkQuery }"
        class="btn btn--sec tabs__tab"
        role="tab"
      >
        {{ $t('general.admin') }}
      </router-link>
    </nav>

    <period-selector
      v-if="_periods.length"
      :periods="_periods"
      :show-date-picker="$route.name === 'ItemMeasurements'"
    />
  </div>
</template>

<script>
import { mapState, mapGetters } from 'vuex';
import PeriodSelector from '@/components/PeriodSelector.vue';
import getPeriods from '@/config/periods';

export default {
  name: 'ItemTabBar',

  components: {
    PeriodSelector,
  },

  computed: {
    ...mapState([
      'activeItem',
      'activeKeyResult',
      'activeKpi',
      'activeObjective',
      'periods',
    ]),
    ...mapGetters(['hasEditRights']),

    itemTabs() {
      return [
        {
          route: { name: 'ItemHome' },
          label: this.$t('general.OKRsLong'),
          shortLabel: this.$t('general.OKRs'),
        },
        {
          route: { name: 'ItemMeasurements' },
          label: this.$t('general.KPIs'),
        },
        {
          route: { name: 'ItemAbout' },
          label: `${this.$t('about.about')} ${this.activeItem.name}`,
          shortLabel: this.$t('about.about'),
        },
      ];
    },

    adminLinkQuery() {
      switch (this.$route.name) {
        case 'ItemHome':
          return { tab: 'okr' };
        case 'ObjectiveHome':
          return { tab: 'okr', type: 'objective', id: this.activeObjective?.id };
        case 'KeyResultHome':
          return { tab: 'okr', type: 'keyResult', id: this.activeKeyResult?.id };
        case 'ItemMeasurements':
          return { tab: 'kpi' };
        default:
          return {};
      }
    },

    _periods() {
      if (this.$route.name === 'ItemHome') {
        return this.periods.map((p) => ({
          label: p.name,
          key: p.id,
          id: p.id,
          startDate: p.startDate.toDate(),
          endDate: p.endDate.toDate(),
        }));
      }
      if (this.$route.name === 'ItemMeasurements') {
        return Object.values(getPeriods());
      }
      return [];
    },
  },
};
</script>

<style lang="scss" scoped>
.sub-navigation {
  position: sticky;
  top: 4rem;
  z-index: 20;
  display: flex;
}

.tabs {
  flex-grow: 1;
  box-sizing: border-box;
  background-color: var(--color-white);

  &__tab {
    padding: 1.25rem 1rem;
    color: var(--color-grayscale-40);
    border: unset;

    > svg {
      --fg-color: var(--color-grayscale-40);
      height: 1rem;
      margin-right: 0.5rem;
    }

    &--right {
      margin-left: auto;
    }

    &.router-link-active {
      position: relative;
      color: var(--color-blue-dark);
      cursor: default;

      > svg {
        --fg-color: var(--color-blue-dark);
      }

      &::after {
        position: absolute;
        right: 0;
        bottom: 0;
        left: 0;
        height: 0.25rem;
        background-color: var(--color-active-light);
        content: '';
      }
    }

    &:hover:not(.router-link-active):not(:disabled) {
      position: relative;
      color: var(--color-blue-dark);
      background-color: var(--color-gray-light);
    }
  }
}
</style>
